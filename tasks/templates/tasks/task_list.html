<!DOCTYPE html>
<html>
  <head>
    <title>My Task Manager</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .task-card {
        transition: all 0.3s ease;
      }
      .completed {
        opacity: 0.7;
        background-color: #f8f9fa;
      }
      .completed h5 {
        text-decoration: line-through;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <h1 class="mb-4">My Task Manager</h1>

      <!-- Add Task Form -->
      <div class="card mb-4">
        <div class="card-body">
          <h5>Add New Task</h5>
          <form method="post" action="{% url 'add_task' %}">
            {% csrf_token %}
            <div class="mb-3">
              <input
                type="text"
                name="title"
                class="form-control"
                placeholder="Task title..."
                required
              />
            </div>
            <div class="mb-3">
              <textarea
                name="description"
                class="form-control"
                placeholder="Description (optional)"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Task</button>
          </form>
        </div>
      </div>

      <!-- Task List -->
      <div class="tasks-container">
        {% for task in tasks %}
        <div
          class="card mb-3 task-card {% if task.completed %}completed{% endif %}"
        >
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h5 class="mb-2">{{ task.title }}</h5>
                {% if task.description %}
                <p class="text-muted mb-2">{{ task.description }}</p>
                {% endif %}
              </div>

              <div class="btn-group">
                <!-- Toggle Complete Button -->
                <a
                  href="{% url 'toggle_task' task.id %}"
                  class="btn btn-sm {% if task.completed %}btn-success{% else %}btn-outline-success{% endif %}"
                >
                  {% if task.completed %}âœ“ Done{% else %}Mark Done{% endif %}
                </a>

                <!-- Edit Button (Modal) -->
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#editModal{{ task.id }}"
                >
                  Edit
                </button>

                <!-- Delete Button -->
                <a
                  href="{% url 'delete_task' task.id %}"
                  class="btn btn-sm btn-outline-danger"
                  onclick="return confirm('Are you sure you want to delete this task?')"
                >
                  Delete
                </a>
              </div>
            </div>

            {% if task.completed %}
            <small class="text-muted"
              >Completed on {{ task.created_at|date:"M d, Y" }}</small
            >
            {% else %}
            <small class="text-muted"
              >Added {{ task.created_at|timesince }} ago</small
            >
            {% endif %}
          </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal{{ task.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Task</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>
              <form method="post" action="{% url 'edit_task' task.id %}">
                {% csrf_token %}
                <div class="modal-body">
                  <div class="mb-3">
                    <input
                      type="text"
                      name="title"
                      class="form-control"
                      value="{{ task.title }}"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <textarea name="description" class="form-control">
{{ task.description }}</textarea
                    >
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="alert alert-info">
          <h4>No tasks yet!</h4>
          <p>Add your first task using the form above.</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
